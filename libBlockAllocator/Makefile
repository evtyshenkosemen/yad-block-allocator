include .env
export $(sed 's/=.*//' .env)

#colors
ccred=\033[0;31m
ccgreen=\033[0;32m
ccyellow=\033[0;33m
ccend=\033[0m

all: clean build

checkconfig:
	@echo "${ccyellow}Checking env config ${ccend}"
	#Check & restore config here

build:autoconf
	@echo "${ccgreen}Starting build${ccend}"

	${CC} -c -fPIC -Wno-format ${SOURCE_DIR}/allocator.c -o ${BUILD_DIR}/allocator.o -I${INCLUDE_DIR}

	#pack dynamic lib
	${CC} -shared -o ${BUILD_DIR}/allocator.so ${BUILD_DIR}/allocator.o
	
	#pack static lib
	${AR} rcs ${BUILD_DIR}/allocator.a ${BUILD_DIR}/allocator.o

	#spice up  with headers
	cp ${INCLUDE_DIR}/allocator.h ${BUILD_DIR}/allocator.h
	cp ${INCLUDE_DIR}/autoconf.h ${BUILD_DIR}/autoconf.h

autoconf:checkconfig
	@echo "${ccgreen}Build configurated with pool: ${POOL_SIZE}; block: ${BLOCK_SIZE} ${ccend}"
	@echo "/* Autogenerated content! Do not edit! */" > ./inc/autoconf.h
	@echo "#define BLOCK_SIZE ${BLOCK_SIZE}" >> ./inc/autoconf.h
	@echo "#define POOL_SIZE ${POOL_SIZE}" >> ./inc/autoconf.h

clean:
	@echo "${ccyellow}Cleaning build dir ${ccend}"
	rm -rf ./bin/
	mkdir bin
